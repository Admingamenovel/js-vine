<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html;
       charset=utf-8" />
<title>JavaScript Visual Novel Engine: Advanced Topics</title>
<link rel="stylesheet" href="style.css"/>
</head>

<body>
<h1>JavaScript Visual Novel Engine: Advanced Topics</h1>

<ol>
<li><a href="#textblocks">Text Blocks</a>
    <ol class="letter">
    <a href="#posWidth">Position and Width</a>
    <a href="#initWithText">Displaying without Changes</a>
    </ol>
</li>
<li><a href="#variables">Variables</a></li>
<li><a href="#ifStatement">The <code>ifStatement</code></a></li>
<li><a href="#subroutines">Subroutines</a></li>
<li><a href="#jscall">Calling JavaScript from your Novel</a></li>
</ol>

<h2><a id="textblocks">Text Blocks</a></h2>
<p>
Sometimes you need a text to appear in the tableau. You use a
<code>TextBlock</code> character to do this. To initialize a
<code>TextBlock</code>, you give the block a name and optionally
parameters. Your parameters can be the following:
</p>
<table>
    <thead>
        <tr><th>Property</th><th>Meaning</th></tr>
    </thead>
    <tbody>
    <tr><td><code>color</code></td>
        <td>text color for this block, specified as in CSS</td></tr>
    <tr><td><code>backgroundColor</code></td>
        <td>background color for this block, specified as in CSS</td></tr>
    <tr><td><code>position</code></td>
        <td>where to display this text block. The <code>xAnchor</code>
        and <code>yAnchor</code> are ignored.</td></tr>
    <tr><td><code>align</code></td>
        <td>text alignment, specified as in CSS</td></tr>
    <tr><td><code>border</code></td>
        <td>a border specification as in CSS</td></tr>
    <tr><td><code>font</code></td>
        <td>the font to use to display the text</td></tr>
    <tr><td><code>width</code></td>
        <td>decimal percent of width of the window; range from 0 to 1.0</td></tr>
    <tr><td><code>visibility</code></td>
        <td>"visible" or "hidden", as in CSS</td></tr>
    <tr><td><code>text</code></td>
        <td>an HTML string to display inside the text area</td></tr>
    </tbody>
</table>
<p>
The following code creates a <code>TextBlock</code> that will display
red text on a yellow background in 24 point Helvetica font, centered, in
an area 60% the width of the novel with an upper right corner at
position (50&nbsp;,70).
</p>
<div class="inset bordered">
<pre>var sampleText; // goes outside of prepareNovel()
  /* inside the prepareNovel() function, do this: */
  sampleText = new TextBlock("sample",
    {
      color: "red", backgroundColor: "#ff0",
      font: "24pt Helvetica", align: "center",
      width: 0.6,
      position: new Position(50, 70)
    }
  );</pre>
</div>

<p>
At the moment, this text block has no text in it. To make it appear
on screen with text, just mention it in your script with the text
you want it to contain.
</p>

<div class="inset bordered">
<pre>script = [
  label, "start",
  scene, "empty.png",
  sampleText, "Here I am!"
];</pre>

<p>
You can change the text block&rsquo;s attributes or text and attributes
simultaneously:
</p>

<pre>
  narrator, "Click to change colors.",
  sampleText, {color: "white", backgroundColor: "#800"},
  narrator, "Click to change the text and border",
  sampleText, {text: "New text", border: "5px double white"}
</pre>
<h2><a id="poswidth">Position and Width</a></h2>
<p>
When you set the position of a text block, the <i>x</i> and
<i>y</i> positions, if less than or equal to 1, indicate a proportion
of the novel&rsquo;s width or height. If greater than 1, they indicate
a pixel position. The xAnchor and yAnchor parameters (which are useful
when centering an image) are not used for text blocks.
</p>
<p>
Ordinarily, a text block takes up the entire width of the tableau.
If you want a block with a width of, say, 40% of the screen width,
you set <code>width:&nbsp;.40</code> If you want that block centered,
horizontally, then its <i>x</i> position must be .30
(30%&nbsp;+&nbsp;40%&nbsp;+&nbsp;30%&nbsp;=&nbsp;100%). In general,
for a text block of width <i>w</i>, you center it by setting the
<i>x</i> position to ((1&nbsp;-&nbsp;<i>w</i>)&nbsp;/&nbsp;2).
</p>

<h2><a id="initWithText">Displaying Without Changes</a></h2>
<p>
What if you included text when you initialized your 
<code>TextBlock</code>, as in the following code?
</p>

<div class="inset bordered">
<pre>var otherText; // outside prepareNovel()
/* inside prepareNovel */
otherText = new TextBlock("other",
  {
    text: "Yet more text.",
    position: new Position(0.25, 0.5),
    width: 0.5
  }
);</pre>
</div>

<p>
Or what if you had changed a scene (which clears the tableau), and
wanted to re-display some text?
How can you display the text area without changing any of its properties?
Just use <code>null</code> as the parameter in your script, and the
text area will appear, exactly as you initialized it.
</p>

<div class="inset bordered">
<pre>  /* previous part of script... */
  narrator, "See some more text.",
  otherText, null,
  narrator, "Scene switches...",
  scene, null, // clear tableau
  narrator, "And now, the colorful text again",
  sampleText, null,
  narrator, "The end"</pre>
</div>
<p>
You may see <a href="textExample/textExample.html">the full
example here</a>.
</p>

<h2><a id="variables">Variables</a></h2>
<p>
Up to this point, the text on every page is the same, independent
of your menu choices. Take a look at
<a href="varExample/varExample.html">this simple novel</a>. You
might think that it has a structure like this (click it to see
it at full size)
</p>

<div class="center">
<a href="images/varExample_flowchart.png"><img
    src="images/varExample_flowchart.png"
    alt="flowchart showing three separate branches"
    width="283" height="225"/></a>
</div>

<p>
And indeed, you could have a separate <code>jump</code> to each
branch. However, if you look at the text, you will see that all
the branches are the same, except for places
where you can &ldquo;fill-in-the-blanks&rdquo;:
</p>

<div class="inset bordered">
<p>Well, if you like <span class="fillin">{{some color name}}</span>...</p>
<p>Perhaps you would like to purchase this lovely
<span class="fillin">{{name of a jewel}}</span></p>
</div>

<p>
And, if the pictures are cleverly named the same as the name of the jewels,
you can display a picture with a name of
<samp><span class="fillin">{{name of a jewel}}</span>.jpg</samp>
</p>

<p>
This is how variables in the visual novel engine work. Here is the
code for the menu that lets you choose your color:
</p>

<div class="inset bordered">
<pre><span class="line"> 1</span>&nbsp;menu, [
<span class="line"> 2</span>&nbsp;  "What&amp;rsquo;s your favorite color?",
<span class="line"> 3</span>&nbsp;  "Red", [ setVars, {color: 'red', jewel: 'ruby'} ],
<span class="line"> 4</span>&nbsp;  "Green", [ setVars, { color: 'green', jewel: 'emerald'} ],
<span class="line"> 5</span>&nbsp;  "Blue", [ setVars, "novel.userVar.color='blue'",
<span class="line"> 6</span>&nbsp;      setVars, "novel.userVar.jewel='sapphire'" ]
<span class="line"> 7</span>&nbsp;],</pre>
</div>

<p>
Lines 3 and 4 show the method you will usually use to set variables, by
giving the variable name and its value. Variable names must follow 
JavaScript rules: they must begin with a letter or underscore, followed by
letters, digits, or underscores.
</p>

<p>
<span class="warning">Important:</span>
What&rsquo;s <em>really</em> happening behind the scenes is that your
&ldquo;variables&rdquo; become part of a special object named
<code>novel.userVar</code>.  Lines 5 and 6 show the &ldquo;hard way&rdquo;
to set variables&mdash;by directly changing the <code>novel.userVar</code>
object. This is important to know so that you can use the variables
later on.  Here&rsquo;s the rest of the script: 
</p>

<div class="inset bordered">
<pre><span class="line"> 8</span>&nbsp;label,"salesPitch",
<span class="line"> 9</span>&nbsp;salesman, "Well, if you like {{novel.userVar.color}}...",
<span class="line">10</span>&nbsp;jewelPhoto, {image: "{{novel.userVar.jewel}}.jpg",
<span class="line">11</span>&nbsp;  visibility: "visible"},
<span class="line">12</span>&nbsp;salesman, "Perhaps you would like to purchase this lovely {{novel.userVar.jewel}}!",
<span class="line">13</span>&nbsp;jump, "ask"</pre>
</div>

<dl>
<dt>Line 8</dt>
    <dd>Because the menu items don&rsquo;t end with a <code>jump</code>,
    you <em>must</em> put a label afterwards; otherwise the novel engine
    will skip too far ahead. (This is not an easy thing to fix.)</dd>
<dt>Lines 9 and 11</dt>
    <dd>When you want to reference a variable, you enclose it in a
    set of double braces <code>{{&nbsp;}}</code>, and you <em>must</em>
    use the <code>novel.userVar</code> notation. The double braces
    <dfn>interpolate</dfn> the variable; that is, they 
    &ldquo;fill in the blank.&rdquo;</dd>
<dt>Line 10</dt>
    <dd>Interpolation isn&rsquo;t just for dialog. You can use it
    for file names and menu items. (<i>Ideally, interpolation will
    work anywhere you can put a quoted string, but I don&rsquo;t 
    know if I have implemented it everywhere. If you find an instance
    where it doesn&rsquo;t work, let me know.</i>)</dd>
</dl>

<p>You can <a href="varExample/varExample.js">see the entire
JavaScript here</a>.</p>

<h3>Really Advanced Topic: Using Plain JavaScript Variables</h3>
<p>
Do you <em>really</em> have to use <code>novel.userVar</code>? No,
you do not. You could create global variables in your JavaScript file:
</p>

<div class="inset bordered">
<pre>/* my own variables (instead of using novel.userVar) */
var myColor;
var myJewel;</pre>
</div>

<p>
And then do this in your script array. Notice that you can put
multiple JavaScript statements separated by
semicolons into a single <code>setVars</code>;
that&rsquo;s because it <em>is</em> JavaScript.
</p>

<div class="inset bordered">
<pre>menu, [
    "What&amp;rsquo;s your favorite color?",
    "Red", [ setVars, "myColor='red'; myJewel='ruby'" ],
    "Green", [ setVars,"myColor='green'; myJewel='emerald'" ],
    "Blue", [ setVars, "myColor='blue'; myJewel='sapphire'" ]
],
label,"salesPitch",
salesman, "Well, if you like {{myColor}}...",
jewelPhoto, {image: "{{myJewel}}.jpg", visibility: "visible"},
salesman, "Perhaps you would like to purchase this lovely {{myJewel}}!",</pre>
</div>

<p>
You are free to do this if you wish; you just have to be careful that
your variable names don&rsquo;t conflict with anything variables that
have been declared in the <samp>js-vine.js</samp> file. You can
<a href="varExample/varExample2.html">see the script in action here</a> and
<a href="varExample/varExample2.js">see the JavaScript here</a>
</p>

<h2><a id="ifStatement">The <code>ifStatement</code></a></h2>
<p>
</p>
<h2><a id="subroutines">Subroutines</a></h2>
<p>
</p>
<h2><a id="jscall">Calling JavaScript from your Novel</a></h2>
<p>
</p>
</body>
</html>

